<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="docker/index.html"><strong aria-hidden="true">1.</strong> Docker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="docker/dockerfile/index.html"><strong aria-hidden="true">1.1.</strong> Dockerfile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="docker/dockerfile/golang.html"><strong aria-hidden="true">1.1.1.</strong> Golang</a></li><li class="chapter-item expanded "><a href="docker/dockerfile/node.html"><strong aria-hidden="true">1.1.2.</strong> NodeJS</a></li><li class="chapter-item expanded "><a href="docker/dockerfile/python.html"><strong aria-hidden="true">1.1.3.</strong> Python</a></li><li class="chapter-item expanded "><a href="docker/dockerfile/flutter.html"><strong aria-hidden="true">1.1.4.</strong> Flutter</a></li></ol></li><li class="chapter-item expanded "><a href="docker/docker-compose/index.html"><strong aria-hidden="true">1.2.</strong> Docker Compose</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="docker/docker-compose/postgres.html"><strong aria-hidden="true">1.2.1.</strong> PostgreSQL</a></li><li class="chapter-item expanded "><a href="docker/docker-compose/mongo.html"><strong aria-hidden="true">1.2.2.</strong> MongoDB</a></li><li class="chapter-item expanded "><a href="docker/docker-compose/redis.html"><strong aria-hidden="true">1.2.3.</strong> Redis</a></li><li class="chapter-item expanded "><a href="docker/docker-compose/gitlab.html"><strong aria-hidden="true">1.2.4.</strong> Gitlab Runner</a></li><li class="chapter-item expanded "><a href="docker/docker-compose/drone.html"><strong aria-hidden="true">1.2.5.</strong> Drone CI</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="gitlab/index.html"><strong aria-hidden="true">2.</strong> GitLab CI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="gitlab/docker.html"><strong aria-hidden="true">2.1.</strong> Build Docker Image</a></li><li class="chapter-item expanded "><a href="gitlab/ssh.html"><strong aria-hidden="true">2.2.</strong> Run SSH command</a></li><li class="chapter-item expanded "><a href="gitlab/helm.html"><strong aria-hidden="true">2.3.</strong> Deploy to K8s via Helm</a></li></ol></li><li class="chapter-item expanded "><a href="drone/index.html"><strong aria-hidden="true">3.</strong> Drone CI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="drone/docker.html"><strong aria-hidden="true">3.1.</strong> Build Docker Image</a></li><li class="chapter-item expanded "><a href="drone/ssh.html"><strong aria-hidden="true">3.2.</strong> Run SSH command</a></li><li class="chapter-item expanded "><a href="drone/ansible.html"><strong aria-hidden="true">3.3.</strong> Run Ansible playbook</a></li></ol></li><li class="chapter-item expanded "><a href="bitbucket/index.html"><strong aria-hidden="true">4.</strong> Bitbucket</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="bitbucket/ssh.html"><strong aria-hidden="true">4.1.</strong> Run SSH command</a></li></ol></li><li class="chapter-item expanded "><a href="github/index.html"><strong aria-hidden="true">5.</strong> GitHub Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="github/docker.html"><strong aria-hidden="true">5.1.</strong> Build Docker Image</a></li><li class="chapter-item expanded "><a href="github/ssh.html"><strong aria-hidden="true">5.2.</strong> Run SSH command</a></li><li class="chapter-item expanded "><a href="github/pages.html"><strong aria-hidden="true">5.3.</strong> Deploy to Pages</a></li></ol></li><li class="chapter-item expanded "><a href="miscellaneous/index.html"><strong aria-hidden="true">6.</strong> Miscellaneous</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="miscellaneous/bitrix-password.html"><strong aria-hidden="true">6.1.</strong> Bitrix admin without password</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/Russia9/notes" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="docker"><a class="header" href="#docker">Docker</a></h1>
<p>Docker-related notes section</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dockerfile"><a class="header" href="#dockerfile">Dockerfile</a></h1>
<p>Dockerfiles for several technologies</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="golang"><a class="header" href="#golang">Golang</a></h1>
<h2 id="optimized-dockerfile"><a class="header" href="#optimized-dockerfile">Optimized Dockerfile</a></h2>
<pre><code class="language-dockerfile"># Build container
FROM golang:1.22-bullseye AS build

# Set build workdir
WORKDIR /app

# Copy app sources
COPY . .

# Build app
RUN go build -o app .

# ---
# Production container
FROM debian:bullseye-slim

# Set app workdir
WORKDIR /app

# Copy binary
COPY --from=build /app/app .

# Run app
CMD ["./app"]
</code></pre>
<h2 id="common-dockerfile"><a class="header" href="#common-dockerfile">Common Dockerfile</a></h2>
<pre><code class="language-dockerfile">FROM golang:1.22

# Set app workdir
WORKDIR /go/src/app

# Copy dependencies list
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy application sources
COPY . .

# Build app
RUN go build -o app .

# Run app
CMD ["./app"]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nodejs"><a class="header" href="#nodejs">NodeJS</a></h1>
<h2 id="static-site-webpack"><a class="header" href="#static-site-webpack">Static Site (Webpack)</a></h2>
<h3 id="dockerfile-1"><a class="header" href="#dockerfile-1">Dockerfile</a></h3>
<pre><code class="language-dockerfile"># Build container
FROM node:21.7.3-bullseye-slim AS build

# Set build workdir
WORKDIR /usr/src/app

# Copy dependencies list
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy app sources
COPY . .

# Run tests
RUN CI=true npm run test

# Build app
RUN npm run build

# ---
# Production container
FROM nginx:1.25.4-alpine

# Copy nginx.conf
COPY --from=build /usr/src/app/nginx.conf /etc/nginx/conf.d/default.conf

# Copy static files
COPY --from=build /usr/src/app/build/ /usr/share/nginx/html/
</code></pre>
<h3 id="nginxconf"><a class="header" href="#nginxconf">nginx.conf</a></h3>
<pre><code class="language-nginx configuration">server {
    listen 80;
    server_name _ default_server;
    location / {
        root /usr/share/nginx/html;
        try_files $uri /index.html;
    }
}
</code></pre>
<h2 id="common-dockerfile-1"><a class="header" href="#common-dockerfile-1">Common Dockerfile</a></h2>
<pre><code class="language-dockerfile">FROM node:21.7.3-bullseye-slim

# Set app workdir
WORKDIR /usr/src/app

# Copy dependencies list
COPY package*.json ./

# Install dependencies
RUN npm ci

# Copy app sources
COPY . .

# Run tests
RUN CI=true npm run test

# Run app
CMD ["npm", "run", "production"]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="python"><a class="header" href="#python">Python</a></h1>
<h2 id="common-dockerfile-2"><a class="header" href="#common-dockerfile-2">Common Dockerfile</a></h2>
<pre><code class="language-dockerfile">FROM python:3.12

# Stdout without buffer
ENV PYTHONUNBUFFERED=1

# Set app workdir
WORKDIR /usr/src/app

# Copy dependencies list
COPY ./requirements.txt .

# Install dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy app sources
COPY . .

# Run app
CMD ["python", "app.py"]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="flutter"><a class="header" href="#flutter">Flutter</a></h1>
<h2 id="flutter-web-app"><a class="header" href="#flutter-web-app">Flutter Web App</a></h2>
<h3 id="dockerfile-2"><a class="header" href="#dockerfile-2">Dockerfile</a></h3>
<pre><code class="language-dockerfile"># Build container
FROM cirrusci/flutter:2.8.1 AS build

# Set build workdir
WORKDIR /usr/src/app

# Copy app sources
COPY . .

# Build app
RUN flutter build web -t lib/main.dart

# ---
# Production container
FROM nginx:1.21.5

# Copy nginx.conf
COPY --from=build /usr/src/app/nginx.conf /etc/nginx/conf.d/default.conf

# Copy static files
COPY --from=build /usr/src/app/build/web/ /usr/share/nginx/html/
</code></pre>
<h3 id="nginxconf-1"><a class="header" href="#nginxconf-1">nginx.conf</a></h3>
<pre><code class="language-nginx configuration">server { 
    listen 80;
    server_name _ default_server;
    location / {
        root /usr/share/nginx/html;
        try_files $uri /index.html;
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-compose"><a class="header" href="#docker-compose">Docker-compose</a></h1>
<p>Examples of compose files for several technologies</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql"><a class="header" href="#postgresql">PostgreSQL</a></h1>
<pre><code class="language-yaml">services:
  postgres:
    image: postgres:13.3
    restart: always
    environment:
      POSTGRES_DB: "dbname"
      POSTGRES_PASSWORD: "superpassword"
    ports:
      - "127.0.0.1:5432:5432"
    volumes:
      - "postgres_data:/var/lib/postgresql/data"

volumes:
  postgres_data:

</code></pre>
<p>*<strong>Replace <code>dbname</code> and <code>superpassword</code> with your values</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mongodb"><a class="header" href="#mongodb">MongoDB</a></h1>
<pre><code class="language-yaml">services:
  mongo:
    image: mongo:7.0.9
    restart: always
    environment:
      MONGO_INITDB_DATABASE: "dbname"
      MONGO_INITDB_ROOT_USERNAME: "root"
      MONGO_INITDB_ROOT_PASSWORD: "superpassword"
    ports:
      - "127.0.0.1:27017:27017"
    volumes:
      - "mongo_data:/data/db"

volumes:
  mongo_data:
</code></pre>
<p>*<strong>Use <code>mongo:4.4</code> image if your system does not support AVX instructions</strong> <br>
**<strong>Replace <code>dbname</code> and <code>superpassword</code> with your values</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="redis"><a class="header" href="#redis">Redis</a></h1>
<pre><code class="language-yaml">services:
  redis:
    image: redis:7.2.4
    restart: always
    ports:
      - "127.0.0.1:6379:6379"
    volumes:
      - "redis_data:/var/lib/redis"

volumes:
  redis_data:
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="gitlab-runner-installation"><a class="header" href="#gitlab-runner-installation">Gitlab Runner <a href="https://docs.gitlab.com/runner/install/">Installation</a></a></h2>
<h4 id="docker-composeyml"><a class="header" href="#docker-composeyml">docker-compose.yml</a></h4>
<pre><code class="language-yaml">services:
  runner:
    image: gitlab/gitlab-runner
    restart: always
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
      - "./config.toml:/etc/gitlab-runner/config.toml"
</code></pre>
<h4 id="configtoml-docs"><a class="header" href="#configtoml-docs">config.toml <a href="https://docs.gitlab.com/runner/configuration/advanced-configuration.html"><strong>Docs</strong></a></a></h4>
<pre><code class="language-toml">[[runners]]
name = "Runner Name"
url = "https://gitlab.com/"
token = "supersecrettoken"
executor = "docker"
concurrent = 10
[runners.docker]
tls_verify = false
image = "docker"
privileged = true
disable_cache = false
volumes = ["/certs/client", "/cache"]
[runners.cache]
[runners.cache.s3]
[runners.cache.gcs]
</code></pre>
<p>*<strong>Replace <code>supersecrettoken</code> with your value</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="drone-ci-installation-gitlab"><a class="header" href="#drone-ci-installation-gitlab">Drone CI <a href="https://docs.drone.io/server/provider/gitlab/"><strong>Installation (Gitlab)</strong></a></a></h2>
<pre><code class="language-yaml">services:
  drone:
    image: drone/drone
    restart: always
    environment:
      DRONE_GITLAB_SERVER: "https://gitlab.com"
      DRONE_GITLAB_CLIENT_ID: "gitlab_oauth_client_id"
      DRONE_GITLAB_CLIENT_SECRET: "gitlab_oauth_secret"
      DRONE_RPC_SECRET: "drone_rpc_secret"
      DRONE_SERVER_HOST: "drone.example.com"
      DRONE_SERVER_PROTO: "https"
      DRONE_USER_CREATE: "username:SomeGitlabUser,admin:true"
    ports:
      - "127.0.0.1:8080:80"
    volumes:
      - "./data:/data"

  drone-runner:
    image: drone/drone-runner-docker
    restart: always
    environment:
      DRONE_RUNNER_NAME: "drone_runner_name"
      DRONE_RUNNER_CAPACITY: "10"
      DRONE_RPC_SECRET: "drone_rpc_secret"
      DRONE_RPC_HOST: "drone.example.com"
      DRONE_RPC_PROTO: "https"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
</code></pre>
<p>*<strong>Replace <code>drone_*</code>, <code>gitlab_*</code> and <code>drone.example.com</code> with your values</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gitlab"><a class="header" href="#gitlab">GitLab</a></h1>
<p>GitlabCI-related notes section</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-docker-image"><a class="header" href="#build-docker-image">Build Docker image</a></h1>
<pre><code class="language-yaml">stages:
  - build

services:
  - docker:20.10.12-dind

variables:
  TAG_LATEST: $CI_REGISTRY_IMAGE/$CI_COMMIT_REF_NAME:latest
  TAG_COMMIT: $CI_REGISTRY_IMAGE/$CI_COMMIT_REF_NAME:$CI_COMMIT_SHORT_SHA

build:
  image: docker:20.10.12
  stage: build

  before_script:
    # Login to GitLab Registry
    - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin $CI_REGISTRY
    # Pull last image to use cache
    - docker pull "$TAG_LATEST" || true
  script:
    # Build Image
    - docker build --cache-from "$TAG_LATEST" -t $TAG_COMMIT -t $TAG_LATEST .
    # Push to GitLab Registry
    - docker push $TAG_COMMIT
    - docker push $TAG_LATEST
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-ssh-command"><a class="header" href="#run-ssh-command">Run SSH command</a></h1>
<pre><code class="language-yaml">stages:
  # ...
  - deploy

deploy:
  stage: deploy
  before_script:
    - chmod 600 $SSH_KEY
    - apk update &amp;&amp; apk add openssh-client
  script:
    - ssh -i $SSH_KEY -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST "command1"
    - ssh -i $SSH_KEY -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST "command2"
#  only:
#    - master
#  environment: production
</code></pre>
<h2 id="ci-variables"><a class="header" href="#ci-variables">CI Variables</a></h2>
<h3 id="ssh_key"><a class="header" href="#ssh_key"><code>SSH_KEY</code></a></h3>
<p>Type: <code>File</code> <br>
<strong>\n at the end of the file!</strong></p>
<h3 id="ssh_host"><a class="header" href="#ssh_host"><code>SSH_HOST</code></a></h3>
<p>Type: <code>Variable</code> <br></p>
<h3 id="ssh_user"><a class="header" href="#ssh_user"><code>SSH_USER</code></a></h3>
<p>Type: <code>Variable</code> <br></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploy-to-kubernetes-via-helm"><a class="header" href="#deploy-to-kubernetes-via-helm">Deploy to Kubernetes via Helm</a></h1>
<pre><code class="language-yaml">stages:
  # ...
  - deploy

deploy:
  stage: deploy
  image: alpine/helm:3.7.2
  script:
    # Update Chart Version
    - "sed -i \"s/^appVersion:.*$/appVersion: $CI_COMMIT_SHORT_SHA/\" chart/Chart.yaml"
    # Deploy
    - helm upgrade $CI_PROJECT_NAME chart --install --namespace=$KUBERNETES_NAMESPACE --kubeconfig=$KUBERNETES_CONFIG
#  only:
#    - master
#  environment: production
</code></pre>
<h2 id="ci-variables-1"><a class="header" href="#ci-variables-1">CI Variables</a></h2>
<h3 id="kubernetes_config"><a class="header" href="#kubernetes_config"><code>KUBERNETES_CONFIG</code></a></h3>
<p>Type: <code>File</code></p>
<h3 id="kubernetes_namespace"><a class="header" href="#kubernetes_namespace"><code>KUBERNETES_NAMESPACE</code></a></h3>
<p>Type: <code>Variable</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="drone-ci"><a class="header" href="#drone-ci">Drone CI</a></h1>
<p>Drone CI notes section</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-docker-image-1"><a class="header" href="#build-docker-image-1">Build Docker Image</a></h1>
<pre><code class="language-yaml">kind: pipeline
type: docker
name: build

steps:
  - name: build
    image: plugins/docker
    settings:
      registry: registry.gitlab.com
      username:
        from_secret: docker_username
      password:
        from_secret: docker_password
      repo: registry.gitlab.com/USER/REPO/${DRONE_COMMIT_BRANCH}
      tags:
        - latest
        - ${DRONE_COMMIT_SHA}
      cache_from:
        - registry.gitlab.com/USER/REPO/${DRONE_COMMIT_BRANCH}:latest
</code></pre>
<p>*<strong>Replace <code>USER</code> and <code>REPO</code> by your values</strong></p>
<h2 id="ci-variables-2"><a class="header" href="#ci-variables-2">CI Variables</a></h2>
<h3 id="docker_username"><a class="header" href="#docker_username"><code>docker_username</code></a></h3>
<h3 id="docker_password"><a class="header" href="#docker_password"><code>docker_password</code></a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-ssh-command-1"><a class="header" href="#run-ssh-command-1">Run SSH command</a></h1>
<pre><code class="language-yaml">kind: pipeline
type: docker
name: deploy

clone:
  disable: true

steps:
  - name: deploy
    image: appleboy/drone-ssh
    settings:
      host:
        from_secret: ssh_address
      username:
        from_secret: ssh_username
      key:
        from_secret: ssh_key
      port: 22
      script_stop: true
      script:
        - command1
        - command2

trigger:
  branch:
    - master
  event:
    - push
</code></pre>
<h2 id="ci-variables-3"><a class="header" href="#ci-variables-3">CI Variables</a></h2>
<h3 id="ssh_key-1"><a class="header" href="#ssh_key-1"><code>ssh_key</code></a></h3>
<p><strong>\n at the end of the file!</strong></p>
<h3 id="ssh_address"><a class="header" href="#ssh_address"><code>ssh_address</code></a></h3>
<h3 id="ssh_username"><a class="header" href="#ssh_username"><code>ssh_username</code></a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-ansible-playbook"><a class="header" href="#run-ansible-playbook">Run Ansible playbook</a></h1>
<pre><code class="language-yaml">kind: pipeline
type: docker
name: deploy

steps:
  - name: deploy
    image: librespace/ansible:latest
    environment:
      ANSIBLE_INVENTORY:
        from_secret: ansible_inventory
      ANSIBLE_SSH_KEY:
        from_secret: ansible_ssh_key
    commands:
      - apt update &amp;&amp; apt-get install -y ssh
      - echo "$ANSIBLE_INVENTORY" &gt; ansible/inventory.yml
      - echo "$ANSIBLE_SSH_KEY" &gt; ansible/id_ecdsa &amp;&amp; chmod 600 ansible/id_ecdsa

      - ansible-galaxy collection install -r ansible/requirements.yml # Install requirements (If needed)
      
      - ansible-playbook -i ansible/inventory.yml --private-key ansible/id_ecdsa --ssh-common-args='-o StrictHostKeyChecking=no' ansible/playbook.yml

trigger:
  branch:
    - master
  event:
    - push
</code></pre>
<h2 id="ci-variables-4"><a class="header" href="#ci-variables-4">CI Variables</a></h2>
<h3 id="ansible_ssh_key"><a class="header" href="#ansible_ssh_key"><code>ansible_ssh_key</code></a></h3>
<p><strong>\n at the end of the file!</strong></p>
<h3 id="ansible_inventory"><a class="header" href="#ansible_inventory"><code>ansible_inventory</code></a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitbucket"><a class="header" href="#bitbucket">Bitbucket</a></h1>
<p>Bitbucket-related notes section</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-ssh-command-2"><a class="header" href="#run-ssh-command-2">Run SSH command</a></h1>
<pre><code class="language-yaml">image: atlassian/default-image:latest

pipelines:
  branches:
    master:
      - step:
          deployment: production
          clone:
            enabled: false
          script:
            - echo "command1" | ssh $SSH_USER@$SSH_HOST
            - echo "command2" | ssh $SSH_USER@$SSH_HOST
</code></pre>
<h2 id="ci-variables-5"><a class="header" href="#ci-variables-5">CI Variables</a></h2>
<h3 id="ssh_host-1"><a class="header" href="#ssh_host-1"><code>SSH_HOST</code></a></h3>
<h3 id="ssh_user-1"><a class="header" href="#ssh_user-1"><code>SSH_USER</code></a></h3>
<p><strong>Copy SSH pubkey to server (<code>Repo Settings/Pipelines/SSH keys</code>)</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="github-actions"><a class="header" href="#github-actions">GitHub Actions</a></h1>
<p>Actions-related notes section</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="build-docker-image-2"><a class="header" href="#build-docker-image-2">Build Docker Image</a></h1>
<pre><code class="language-yaml">name: Docker

on: [push]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Log into registry ${{ env.REGISTRY }}
        if: github.event_name != 'pull_request'
        uses: docker/login-action@v1.12.0
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract Docker metadata
        id: meta
        uses: docker/metadata-action@v3.6.2
        with:
          images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}

      - name: Build and push Docker image
        uses: docker/build-push-action@v2.7.0
        with:
          context: .
          push: ${{ github.event_name != 'pull_request' }}
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-ssh-command-3"><a class="header" href="#run-ssh-command-3">Run SSH command</a></h1>
<pre><code class="language-yaml">name: Deploy

on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # ...

      - name: ssh-pipeline
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          port: ${{ secrets.SSH_PORT }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            someSshCommand
</code></pre>
<h2 id="secrets"><a class="header" href="#secrets">Secrets</a></h2>
<ul>
<li><code>SSH_HOST</code></li>
<li><code>SSH_PORT</code></li>
<li><code>SSH_USER</code></li>
<li><code>SSH_KEY</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploy-to-github-pages"><a class="header" href="#deploy-to-github-pages">Deploy to GitHub Pages</a></h1>
<pre><code class="language-yaml">name: Github Pages

on: [push]

jobs:
  pages:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.1

      - name: Build HTML
        run: |
          npm ci
          npm build

      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@4.1.7
        with:
          branch: gh-pages
          folder: build
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="miscellaneous-stuff"><a class="header" href="#miscellaneous-stuff">Miscellaneous stuff</a></h1>
<p>Single notes without a category</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitrix-admin-panel-without-password"><a class="header" href="#bitrix-admin-panel-without-password">Bitrix admin panel without password</a></h1>
<pre><code class="language-php">&lt;?
require($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_before.php");
global $USER;
$USER-&gt;Authorize(1);
@unlink(__FILE__); // Delete file
LocalRedirect("/bitrix/admin/");
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
